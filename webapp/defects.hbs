<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sketchfab Viewer API example</title>

    <!-- Insert this script -->
    <script type="text/javascript" src="https://static.sketchfab.com/api/sketchfab-viewer-1.3.1.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"  crossorigin="anonymous">
	
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"  crossorigin="anonymous"></script>
	
	
	
</head>
<body>
    	
	<!-- Main navigation -->
<header>
  <!--Navbar-->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top scrolling-navbar">
    <div class="container">
      <a class="navbar-brand" href="#">
        <strong>SDM</strong>
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent-7" aria-controls="navbarSupportedContent-7" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent-7">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item ">
            <a class="nav-link" href="\">Add Defect
              <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="\getAnnotationList">Defects</a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </nav>
  <!-- Navbar -->
  <!-- Full Page Intro -->
  <div class="view" style="background-image: url('https://mdbootstrap.com/img/Photos/Others/images/31.jpg'); background-repeat: no-repeat; background-size: cover; background-position: center center;">
    <!-- Mask & flexbox options-->
    <div class="mask rgba-indigo-strong d-flex justify-content-center align-items-center">
      <!-- Content -->
      <div class="container">
        <!--Grid row-->
        <div class="row pt-lg-5 mt-lg-5">
          <!--Grid column-->
          <div class="col-md-6 mb-5 mt-md-0 mt-5 white-text text-center text-md-left wow fadeInLeft" data-wow-delay="0.3s">
            <h1 class="display-4 font-weight-bold">A-321</h1>
            <hr class="hr-light">
            <h6 class="mb-3">
				<iframe src="" id="api-frame" height="500" width="500"></iframe>
			</h6>
            
          </div>
          <!--Grid column-->
          <!--Grid column-->
          <div class="col-md-6 col-xl-5 mb-4">
            <!--Form-->
            <div class="card wow fadeInRight" data-wow-delay="0.3s">
              <div class="card-body z-depth-2">
                <!--Header-->
                <div class="text-center">
                  <h3 class="dark-grey-text">
                    <strong>Defect List</strong>
                  </h3>
                  <hr>
                </div>
				
                <!--Body-->
				<table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
				  <thead>
					<tr>
					  <th class="th-sm">Defect Id
						<i class="fa fa-sort float-right" aria-hidden="true"></i>
					  </th>
					  <th class="th-sm">Title
						<i class="fa fa-sort float-right" aria-hidden="true"></i>
					  </th>
					  <th class="th-sm">Description
						<i class="fa fa-sort float-right" aria-hidden="true"></i>
					  </th>      
					  <th class="th-sm">Creation date
						<i class="fa fa-sort float-right" aria-hidden="true"></i>
					  </th>      
					</tr>
				  </thead>
				  <tbody>
					{{#each annos}}
						<tr id="defect_{{@index}}" onclick="showAnno({{@index}})">
						  <td>{{@index}}</td>
						  <td>{{this.title}}</td>
						  <td>{{this.descr}}</td>		  
						  <td>2018/10/15</td>		  
						</tr>
				   {{/each}} 
				  </tbody>
				  <tfoot>
					<tr>
					  <th>Defect Id
					  </th>
					  <th>Title
					  </th>
					  <th>Description
					  </th>      
					  <th>Creation date
					  </th>      
					</tr>
				  </tfoot>
			</table>
                
                
              </div>
            </div>
            <!--/.Form-->
          </div>
          <!--Grid column-->
        </div>
        <!--Grid row-->
      </div>
      <!-- Content -->
    </div>
    <!-- Mask & flexbox options-->
  </div>
  <!-- Full Page Intro -->
</header>
<!-- Main navigation -->
	
    <!-- Initialize the viewer -->
    <script type="text/javascript">
	
	function showAnno(obj) {
		alert(obj);
	}
	
	
	$(document).ready(function () {
	  $('#dtBasicExample').DataTable();
	  $('.dataTables_length').addClass('bs-select');
	});

	var annolist = [];
	
	
    var iframe = document.getElementById('api-frame');
	var urlid = 'dbf6450b82a4461c9393dda70fb66a43';

    // By default, the latest version of the viewer API will be used.
    var client = new Sketchfab( iframe );

    // Alternatively, you can request a specific version.
    // var client = new Sketchfab( '1.3.0', iframe );
	
	function onSuccess( api ){ 

		
		
			api.start( function() {
			
				$('#loadAnno').click(function() {
					init();
				});	
				
				
				
				api.addEventListener('viewerready', function() {
						
					annolist.forEach(function (obj) {
							
							console.log('inside create', obj)						  
							  api.createAnnotation(
								[obj.pox, obj.poy, obj.poz],
								[obj.nox, obj.noy, obj.noz],
								obj.camPos,
								obj.camTarget,
								obj.title,
								obj.descr,
								function(index) {								
								  console.log('added hotspot: ' + index);								  
								  api.removeAnnotation(index);							  
								  
								}
							 );					  			  
						 
						});
				
					

							
				});
				
			});
			
			
			
		}
		
		function onError( error ) {
			console.log(error);
		}

    function init() {
	var jqxhr = jQuery.get( "/getAnnotations", function(data) {
					  console.log('success');
					})
					  .done(function(dataDone) {
					  console.log('dataDone ', dataDone);
						annolist = dataDone;
						client.init( urlid, {
							success: onSuccess,
							error: onError,
							annotation: 0,
							annotations_visible: 0,
							ui_controls: 0
							
						});
					  })
					  .fail(function() {
						console.log( "error" );
					  })
					  .always(function() {
						console.log( "finished" );
					  });
	
	}
	
	init();
	
	
    </script>	

</body>
</html>